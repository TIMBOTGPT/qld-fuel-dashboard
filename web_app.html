<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Queensland Fuel Price Finder</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios@1.6.0/dist/axios.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.js"></script>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'qld-blue': '#003f7f',
                        'qld-gold': '#ffd700'
                    }
                }
            }
        }
    </script>
    <style>
        @keyframes pulse {
            0%, 100% { 
                transform: scale(1); 
                box-shadow: 0 4px 8px rgba(0,0,0,0.5), 0 0 0 2px white, 0 0 20px rgba(255, 215, 0, 0.3);
            }
            50% { 
                transform: scale(1.05); 
                box-shadow: 0 6px 12px rgba(0,0,0,0.6), 0 0 0 2px white, 0 0 30px rgba(255, 215, 0, 0.6);
            }
        }
        .custom-fuel-marker div {
            animation-fill-mode: both;
        }
    </style>
</head>
<body class="bg-gray-50">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // Queensland suburbs data - comprehensive list including Brisbane suburbs
        const MOCK_SUBURBS = [
            // Major cities and regions
            'Brisbane', 'Gold Coast', 'Townsville', 'Cairns', 'Toowoomba', 'Rockhampton',
            'Mackay', 'Bundaberg', 'Hervey Bay', 'Gladstone', 'Mount Isa', 'Maryborough',
            'Gympie', 'Kingaroy', 'Warwick', 'Stanthorpe', 'Roma', 'Charleville',
            'Longreach', 'Emerald', 'Biloela', 'Gayndah', 'Ipswich', 'Logan',
            'Redland City', 'Moreton Bay', 'Sunshine Coast', 'Fraser Coast',
            
            // Brisbane inner suburbs
            'Fortitude Valley', 'South Brisbane', 'West End', 'New Farm', 'Paddington',
            'Spring Hill', 'Kangaroo Point', 'Woolloongabba', 'East Brisbane', 'Milton',
            'Toowong', 'St Lucia', 'Indooroopilly', 'Newstead', 'Teneriffe', 'Bowen Hills',
            'Herston', 'Kelvin Grove', 'Red Hill', 'Ashgrove', 'Bardon', 'Toowong',
            
            // Brisbane east and southeast suburbs  
            'Morningside', 'Hawthorne', 'Bulimba', 'Balmoral', 'Cannon Hill', 'Murarrie',
            'Tingalpa', 'Wynnum', 'Manly', 'Gumdale', 'Capalaba', 'Cleveland', 'Victoria Point',
            'Redland Bay', 'Mount Cotton', 'Sheldon', 'Thornlands', 'Alexandra Hills',
            
            // Brisbane south suburbs
            'Annerley', 'Greenslopes', 'Stones Corner', 'Coorparoo', 'Camp Hill', 'Holland Park',
            'Mount Gravatt', 'Mansfield', 'Wishart', 'Macgregor', 'Robertson', 'Sunnybank',
            'Runcorn', 'Springwood', 'Daisy Hill', 'Shailer Park', 'Beenleigh', 'Eagleby',
            
            // Brisbane north suburbs
            'Albion', 'Ascot', 'Hamilton', 'Clayfield', 'Hendra', 'Nudgee', 'Northgate',
            'Nundah', 'Banyo', 'Wavell Heights', 'Chermside', 'Stafford', 'Kedron',
            'Wooloowin', 'Lutwyche', 'Windsor', 'Wilston', 'Newmarket', 'Enoggera',
            
            // Brisbane west suburbs
            'Auchenflower', 'Taringa', 'Chapel Hill', 'Kenmore', 'Brookfield', 'Pullenvale',
            'Jindalee', 'Centenary', 'Riverhills', 'Middle Park', 'Jamboree Heights',
            'Corinda', 'Oxley', 'Darra', 'Inala', 'Forest Lake', 'Richlands', 'Ellen Grove',
            
            // Gold Coast suburbs
            'Surfers Paradise', 'Broadbeach', 'Main Beach', 'Southport', 'Labrador', 'Biggera Waters',
            'Runaway Bay', 'Paradise Point', 'Coomera', 'Upper Coomera', 'Pimpama', 'Ormeau',
            'Robina', 'Varsity Lakes', 'Burleigh Heads', 'Miami', 'Mermaid Beach', 'Nobby Beach',
            'Palm Beach', 'Currumbin', 'Tugun', 'Coolangatta', 'Tweed Heads', 'Nerang', 'Mudgeeraba'
        ];

        const FUEL_TYPES = [
            { id: 1, name: 'Unleaded Petrol', code: 'ULP' },
            { id: 2, name: 'Premium Unleaded 95', code: 'PULP95' },
            { id: 3, name: 'Premium Unleaded 98', code: 'PULP98' },
            { id: 4, name: 'Diesel', code: 'DSL' },
            { id: 5, name: 'Premium Diesel', code: 'PDSL' },
            { id: 6, name: 'E10', code: 'E10' },
            { id: 7, name: 'LPG', code: 'LPG' }
        ];

        // API Configuration - using your exact parameters
        const API_CONFIG = {
            baseURL: 'https://fppdirectapi-prod.fuelpricesqld.com.au',
            token: 'b03319f8-7727-493b-9015-b20a7acae110',
            countryId: 21,
            geoRegionLevel: 3
        };

        // Price conversion utility (critical: divide by 1000, not 100)
        const convertPrice = (price) => {
            return (price / 1000).toFixed(3);
        };

        // Mock fuel station data with realistic Brisbane coordinates
        const getMockStations = () => ({
            sites: [
                {
                    siteId: 1,
                    name: 'Brisbane City 7-Eleven',
                    brand: '7-Eleven',
                    address: '123 Queen Street, Brisbane QLD 4000',
                    latitude: -27.4698,
                    longitude: 153.0251,
                    prices: [
                        { fuelType: 'ULP', price: 1650, lastUpdated: new Date().toISOString() },
                        { fuelType: 'DSL', price: 1720, lastUpdated: new Date().toISOString() },
                        { fuelType: 'PULP95', price: 1780, lastUpdated: new Date().toISOString() }
                    ]
                },
                {
                    siteId: 2,
                    name: 'Coles Express Brisbane',
                    brand: 'Coles Express',
                    address: '456 Adelaide Street, Brisbane QLD 4000',
                    latitude: -27.4705,
                    longitude: 153.0260,
                    prices: [
                        { fuelType: 'ULP', price: 1580, lastUpdated: new Date().toISOString() },
                        { fuelType: 'DSL', price: 1690, lastUpdated: new Date().toISOString() },
                        { fuelType: 'PULP95', price: 1750, lastUpdated: new Date().toISOString() }
                    ]
                },
                {
                    siteId: 3,
                    name: 'Shell Brisbane Central',
                    brand: 'Shell',
                    address: '789 George Street, Brisbane QLD 4000',
                    latitude: -27.4720,
                    longitude: 153.0235,
                    prices: [
                        { fuelType: 'ULP', price: 1620, lastUpdated: new Date().toISOString() },
                        { fuelType: 'DSL', price: 1710, lastUpdated: new Date().toISOString() },
                        { fuelType: 'PULP95', price: 1770, lastUpdated: new Date().toISOString() }
                    ]
                },
                {
                    siteId: 4,
                    name: 'BP Connect Morningside',
                    brand: 'BP',
                    address: '321 Wynnum Road, Morningside QLD 4170',
                    latitude: -27.4751,
                    longitude: 153.0721,
                    prices: [
                        { fuelType: 'ULP', price: 1590, lastUpdated: new Date().toISOString() },
                        { fuelType: 'DSL', price: 1700, lastUpdated: new Date().toISOString() },
                        { fuelType: 'PULP95', price: 1760, lastUpdated: new Date().toISOString() }
                    ]
                },
                {
                    siteId: 5,
                    name: 'Ampol Morningside',
                    brand: 'Ampol',
                    address: '654 Wynnum Road, Morningside QLD 4170',
                    latitude: -27.4765,
                    longitude: 153.0735,
                    prices: [
                        { fuelType: 'ULP', price: 1570, lastUpdated: new Date().toISOString() },
                        { fuelType: 'DSL', price: 1680, lastUpdated: new Date().toISOString() },
                        { fuelType: 'PULP95', price: 1740, lastUpdated: new Date().toISOString() }
                    ]
                },
                {
                    siteId: 6,
                    name: 'United Petroleum Bulimba',
                    brand: 'United',
                    address: '987 Oxford Street, Bulimba QLD 4171',
                    latitude: -27.4521,
                    longitude: 153.0621,
                    prices: [
                        { fuelType: 'ULP', price: 1680, lastUpdated: new Date().toISOString() },
                        { fuelType: 'DSL', price: 1750, lastUpdated: new Date().toISOString() },
                        { fuelType: 'PULP95', price: 1820, lastUpdated: new Date().toISOString() }
                    ]
                },
                {
                    siteId: 7,
                    name: 'Metro Petroleum Hawthorne',
                    brand: 'Metro',
                    address: '234 Creek Road, Hawthorne QLD 4171',
                    latitude: -27.4612,
                    longitude: 153.0592,
                    prices: [
                        { fuelType: 'ULP', price: 1600, lastUpdated: new Date().toISOString() },
                        { fuelType: 'DSL', price: 1730, lastUpdated: new Date().toISOString() },
                        { fuelType: 'PULP95', price: 1790, lastUpdated: new Date().toISOString() }
                    ]
                },
                {
                    siteId: 8,
                    name: 'Caltex Woolloongabba',
                    brand: 'Caltex',
                    address: '456 Logan Road, Woolloongabba QLD 4102',
                    latitude: -27.4851,
                    longitude: 153.0321,
                    prices: [
                        { fuelType: 'ULP', price: 1595, lastUpdated: new Date().toISOString() },
                        { fuelType: 'DSL', price: 1695, lastUpdated: new Date().toISOString() },
                        { fuelType: 'PULP95', price: 1765, lastUpdated: new Date().toISOString() }
                    ]
                },
                {
                    siteId: 9,
                    name: 'Puma Energy Cannon Hill',
                    brand: 'Puma',
                    address: '123 Creek Road, Cannon Hill QLD 4170',
                    latitude: -27.4681,
                    longitude: 153.0901,
                    prices: [
                        { fuelType: 'ULP', price: 1585, lastUpdated: new Date().toISOString() },
                        { fuelType: 'DSL', price: 1685, lastUpdated: new Date().toISOString() },
                        { fuelType: 'PULP95', price: 1755, lastUpdated: new Date().toISOString() }
                    ]
                },
                {
                    siteId: 10,
                    name: 'Liberty Coorparoo',
                    brand: 'Liberty',
                    address: '789 Cavendish Road, Coorparoo QLD 4151',
                    latitude: -27.4921,
                    longitude: 153.0521,
                    prices: [
                        { fuelType: 'ULP', price: 1605, lastUpdated: new Date().toISOString() },
                        { fuelType: 'DSL', price: 1705, lastUpdated: new Date().toISOString() },
                        { fuelType: 'PULP95', price: 1775, lastUpdated: new Date().toISOString() }
                    ]
                },
                {
                    siteId: 11,
                    name: '7-Eleven New Farm',
                    brand: '7-Eleven',
                    address: '321 Brunswick Street, New Farm QLD 4005',
                    latitude: -27.4621,
                    longitude: 153.0421,
                    prices: [
                        { fuelType: 'ULP', price: 1615, lastUpdated: new Date().toISOString() },
                        { fuelType: 'DSL', price: 1715, lastUpdated: new Date().toISOString() },
                        { fuelType: 'PULP95', price: 1785, lastUpdated: new Date().toISOString() }
                    ]
                },
                {
                    siteId: 12,
                    name: 'Budget Petrol East Brisbane',
                    brand: 'Budget',
                    address: '654 Stanley Street, East Brisbane QLD 4169',
                    latitude: -27.4721,
                    longitude: 153.0421,
                    prices: [
                        { fuelType: 'ULP', price: 1565, lastUpdated: new Date().toISOString() },
                        { fuelType: 'DSL', price: 1675, lastUpdated: new Date().toISOString() },
                        { fuelType: 'PULP95', price: 1735, lastUpdated: new Date().toISOString() }
                    ]
                },
                {
                    siteId: 13,
                    name: 'Mobil Stones Corner',
                    brand: 'Mobil',
                    address: '987 Logan Road, Stones Corner QLD 4120',
                    latitude: -27.4921,
                    longitude: 153.0421,
                    prices: [
                        { fuelType: 'ULP', price: 1625, lastUpdated: new Date().toISOString() },
                        { fuelType: 'DSL', price: 1725, lastUpdated: new Date().toISOString() },
                        { fuelType: 'PULP95', price: 1795, lastUpdated: new Date().toISOString() }
                    ]
                },
                {
                    siteId: 14,
                    name: 'Speedway Tingalpa',
                    brand: 'Speedway',
                    address: '234 Wynnum Road, Tingalpa QLD 4173',
                    latitude: -27.4821,
                    longitude: 153.1021,
                    prices: [
                        { fuelType: 'ULP', price: 1575, lastUpdated: new Date().toISOString() },
                        { fuelType: 'DSL', price: 1685, lastUpdated: new Date().toISOString() },
                        { fuelType: 'PULP95', price: 1745, lastUpdated: new Date().toISOString() }
                    ]
                },
                {
                    siteId: 15,
                    name: 'EG Petrol Balmoral',
                    brand: 'EG',
                    address: '456 Hawthorne Road, Balmoral QLD 4171',
                    latitude: -27.4621,
                    longitude: 153.0721,
                    prices: [
                        { fuelType: 'ULP', price: 1635, lastUpdated: new Date().toISOString() },
                        { fuelType: 'DSL', price: 1735, lastUpdated: new Date().toISOString() },
                        { fuelType: 'PULP95', price: 1805, lastUpdated: new Date().toISOString() }
                    ]
                },
                {
                    siteId: 16,
                    name: 'Vibe Energy Greenslopes',
                    brand: 'Vibe',
                    address: '789 Logan Road, Greenslopes QLD 4120',
                    latitude: -27.5021,
                    longitude: 153.0521,
                    prices: [
                        { fuelType: 'ULP', price: 1645, lastUpdated: new Date().toISOString() },
                        { fuelType: 'DSL', price: 1745, lastUpdated: new Date().toISOString() },
                        { fuelType: 'PULP95', price: 1815, lastUpdated: new Date().toISOString() }
                    ]
                },
                {
                    siteId: 17,
                    name: 'X Convenience Norman Park',
                    brand: 'X Convenience',
                    address: '321 Wynnum Road, Norman Park QLD 4170',
                    latitude: -27.4821,
                    longitude: 153.0821,
                    prices: [
                        { fuelType: 'ULP', price: 1655, lastUpdated: new Date().toISOString() },
                        { fuelType: 'DSL', price: 1755, lastUpdated: new Date().toISOString() },
                        { fuelType: 'PULP95', price: 1825, lastUpdated: new Date().toISOString() }
                    ]
                }
            ]
        });

        // Suburb Autocomplete Component
        const SuburbAutocomplete = ({ value, onChange, onSelect }) => {
            const [suggestions, setSuggestions] = useState([]);
            const [showSuggestions, setShowSuggestions] = useState(false);

            const handleInputChange = (e) => {
                const inputValue = e.target.value;
                onChange(inputValue);

                if (inputValue.length > 0) {
                    const filtered = MOCK_SUBURBS.filter(suburb =>
                        suburb.toLowerCase().includes(inputValue.toLowerCase())
                    ).slice(0, 5);
                    setSuggestions(filtered);
                    setShowSuggestions(true);
                } else {
                    setShowSuggestions(false);
                }
            };

            const handleSuggestionClick = (suburb) => {
                onSelect(suburb);
                setShowSuggestions(false);
            };

            return React.createElement('div', { className: 'relative' },
                React.createElement('input', {
                    type: 'text',
                    value: value,
                    onChange: handleInputChange,
                    onBlur: () => setTimeout(() => setShowSuggestions(false), 200),
                    placeholder: 'Enter Queensland suburb...',
                    className: 'w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-qld-blue focus:border-transparent'
                }),
                showSuggestions && suggestions.length > 0 && 
                React.createElement('div', { className: 'absolute z-10 w-full mt-1 bg-white border border-gray-300 rounded-lg shadow-lg' },
                    suggestions.map((suburb, index) =>
                        React.createElement('div', {
                            key: index,
                            onClick: () => handleSuggestionClick(suburb),
                            className: 'px-4 py-2 cursor-pointer hover:bg-gray-100'
                        }, suburb)
                    )
                )
            );
        };

        // Map Component for displaying fuel stations
        const FuelStationMap = ({ stations, fuelType, selectedSuburb }) => {
            const mapRef = useRef(null);
            const mapInstance = useRef(null);

            useEffect(() => {
                if (!mapRef.current) return;

                // Initialize map
                if (!mapInstance.current) {
                    mapInstance.current = L.map(mapRef.current).setView([-27.4698, 153.0251], 12);
                    
                    // Add tile layer (free OpenStreetMap)
                    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                        attribution: '© OpenStreetMap contributors'
                    }).addTo(mapInstance.current);
                }

                // Clear existing markers
                mapInstance.current.eachLayer((layer) => {
                    if (layer instanceof L.Marker) {
                        mapInstance.current.removeLayer(layer);
                    }
                });

                if (stations.length === 0) return;

                // Get price range for color coding
                const prices = stations.map(station => {
                    const price = station.prices.find(p => p.fuelType === fuelType);
                    return price ? price.price : 0;
                }).filter(price => price > 0);

                const minPrice = Math.min(...prices);
                const maxPrice = Math.max(...prices);

                // Add markers for each station
                stations.forEach((station, index) => {
                    const price = station.prices.find(p => p.fuelType === fuelType);
                    if (!price || !station.latitude || !station.longitude) return;

                    // Calculate price ratio for color coding
                    const priceRatio = (price.price - minPrice) / (maxPrice - minPrice);
                    
                    // Color code by price using guide colors - Green to Red progression
                    let color;
                    if (priceRatio < 0.25) {
                        color = '#228B22'; // Cheapest - Green (positive/attractive price)
                    } else if (priceRatio < 0.5) {
                        color = '#FFD700'; // Moderate - Yellow (neutral/cautionary)
                    } else if (priceRatio < 0.75) {
                        color = '#FF8C00'; // Expensive - Orange (strong but less alarming)
                    } else {
                        color = '#DC143C'; // Most expensive - Red (immediate negative signal)
                    }
                    
                    // Check if this is the absolute cheapest station
                    const isAbsoluteCheapest = price.price === minPrice;
                    
                    // Determine text color based on background for readability
                    const textColor = color === '#FFD700' ? '#000000' : '#FFFFFF';
                    const textShadow = color === '#FFD700' ? '0 1px 2px rgba(255,255,255,0.8)' : '0 1px 2px rgba(0,0,0,0.8)';
                    
                    // Create marker style
                    let markerStyle, iconSize, iconAnchor;
                    
                    if (isAbsoluteCheapest) {
                        markerStyle = `background: linear-gradient(45deg, #228B22, #32CD32); color: white; border-radius: 8px; width: 55px; height: 32px; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 15px; font-family: Arial, sans-serif; border: 3px solid #FFD700; box-shadow: 0 4px 8px rgba(0,0,0,0.5), 0 0 0 2px white; text-shadow: 0 1px 2px rgba(0,0,0,0.8);`;
                        iconSize = [55, 32];
                        iconAnchor = [27.5, 16];
                    } else {
                        markerStyle = `background-color: ${color}; color: ${textColor}; border-radius: 8px; width: 50px; height: 28px; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 14px; font-family: Arial, sans-serif; border: 2px solid white; box-shadow: 0 3px 6px rgba(0,0,0,0.4); text-shadow: ${textShadow};`;
                        iconSize = [50, 28];
                        iconAnchor = [25, 14];
                    }
                    
                    const markerContent = `$${convertPrice(price.price).slice(0,4)}`;

                    // Create custom marker
                    const marker = L.marker([station.latitude, station.longitude], {
                        icon: L.divIcon({
                            className: 'custom-fuel-marker',
                            html: `<div style="${markerStyle}">${markerContent}</div>`,
                            iconSize: iconSize,
                            iconAnchor: iconAnchor
                        })
                    });

                    // Add popup with station details
                    marker.bindPopup(`
                        <div style="min-width: 200px;">
                            <h3 style="font-weight: bold; margin: 0 0 8px 0;">${station.name}</h3>
                            <p style="margin: 0 0 4px 0; color: #666;">${station.brand}</p>
                            <p style="margin: 0 0 8px 0; font-size: 14px;">${station.address}</p>
                            <div style="background: ${color}; color: white; padding: 4px 8px; border-radius: 4px; text-align: center; font-weight: bold;">
                                ${fuelType}: $${convertPrice(price.price)}
                            </div>
                            <p style="margin: 8px 0 0 0; font-size: 12px; color: #888;">
                                Updated: ${new Date(price.lastUpdated).toLocaleTimeString()}
                            </p>
                        </div>
                    `);

                    marker.addTo(mapInstance.current);
                });

                // Fit map to show all markers
                if (stations.length > 0) {
                    const group = new L.featureGroup(mapInstance.current._layers);
                    if (Object.keys(group._layers).length > 0) {
                        mapInstance.current.fitBounds(group.getBounds().pad(0.1));
                    }
                }

            }, [stations, fuelType]);

            return React.createElement('div', {
                ref: mapRef,
                style: { height: '400px', width: '100%', borderRadius: '8px' }
            });
        };

        // Station Card Component
        const StationCard = ({ station, fuelType, onShowChart, isExpensive = false }) => {
            const price = station.prices.find(p => p.fuelType === fuelType);
            
            if (!price) return null;

            const priceInDollars = convertPrice(price.price);

            return React.createElement('div', {
                className: `bg-white rounded-lg shadow-md p-4 border-l-4 hover:shadow-lg transition-shadow ${
                    isExpensive ? 'border-red-500' : 'border-green-500'
                }`
            },
                React.createElement('div', { className: 'flex justify-between items-start mb-2' },
                    React.createElement('h3', { className: 'font-semibold text-lg' }, station.name),
                    React.createElement('span', {
                        className: `px-2 py-1 rounded text-sm font-bold ${
                            isExpensive ? 'bg-red-100 text-red-800' : 'bg-green-100 text-green-800'
                        }`
                    }, '$' + priceInDollars)
                ),
                React.createElement('p', { className: 'text-gray-600 mb-1 font-medium' }, station.brand),
                React.createElement('p', { className: 'text-gray-600 mb-2 text-sm' }, station.address),
                React.createElement('div', { className: 'flex justify-between items-center' },
                    React.createElement('span', { className: 'text-sm text-gray-500' }, 
                        `📍 ${station.address.split(',')[1]?.trim() || 'Brisbane'}` // Show suburb
                    ),
                    React.createElement('button', {
                        onClick: () => onShowChart(station.siteId, station.name, fuelType),
                        className: 'bg-qld-blue text-white px-3 py-1 rounded text-sm hover:bg-blue-700 transition-colors'
                    }, '📈 View Trend')
                ),
                isExpensive && React.createElement('div', { className: 'mt-2 text-sm text-red-600 font-medium' }, '⚠️ Most Expensive (Reference)'),
                React.createElement('div', { className: 'mt-2 text-xs text-gray-400' }, 
                    'Last updated: ' + new Date(price.lastUpdated).toLocaleTimeString()
                )
            );
        };

        // Main App Component
        const App = () => {
            const [suburb, setSuburb] = useState('');
            const [selectedSuburb, setSelectedSuburb] = useState('');
            const [fuelType, setFuelType] = useState('ULP');
            const [stations, setStations] = useState([]);
            const [loading, setLoading] = useState(false);
            const [error, setError] = useState('');

            const handleSearch = async () => {
                if (!selectedSuburb) {
                    setError('Please select a valid Queensland suburb');
                    return;
                }

                setLoading(true);
                setError('');

                try {
                    // Simulate API call delay
                    await new Promise(resolve => setTimeout(resolve, 1000));
                    
                    const response = getMockStations();
                    
                    if (response && response.sites) {
                        const filteredStations = response.sites.filter(station =>
                            station.prices.some(price => price.fuelType === fuelType)
                        );

                        const sortedStations = filteredStations.sort((a, b) => {
                            const priceA = a.prices.find(p => p.fuelType === fuelType)?.price || Infinity;
                            const priceB = b.prices.find(p => p.fuelType === fuelType)?.price || Infinity;
                            return priceA - priceB;
                        });

                        setStations(sortedStations);
                    } else {
                        setError('No fuel price data available for this suburb');
                    }
                } catch (error) {
                    setError('Failed to fetch fuel prices. Please try again.');
                    console.error('Search error:', error);
                } finally {
                    setLoading(false);
                }
            };

            const exportToCSV = () => {
                if (stations.length > 0) {
                    const csvData = stations.map(station => {
                        const price = station.prices.find(p => p.fuelType === fuelType);
                        return {
                            'Station Name': station.name,
                            'Brand': station.brand,
                            'Address': station.address,
                            'Price ($/L)': price ? convertPrice(price.price) : 'N/A',
                            'Last Updated': price ? new Date(price.lastUpdated).toLocaleString() : 'N/A'
                        };
                    });

                    const csvContent = [
                        Object.keys(csvData[0]).join(','),
                        ...csvData.map(row => Object.values(row).map(val => `"${val}"`).join(','))
                    ].join('\n');

                    const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
                    const url = window.URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `qld-fuel-prices-${new Date().toISOString().split('T')[0]}.csv`;
                    a.click();
                    window.URL.revokeObjectURL(url);
                }
            };

            const cheapestStations = stations.slice(0, 15);
            const mostExpensiveStation = stations.length > 0 ? [stations[stations.length - 1]] : [];

            const prices = stations.map(station => {
                const price = station.prices.find(p => p.fuelType === fuelType);
                return price ? price.price : 0;
            }).filter(price => price > 0);

            const minPrice = prices.length > 0 ? Math.min(...prices) : 0;
            const maxPrice = prices.length > 0 ? Math.max(...prices) : 0;

            return React.createElement('div', { className: 'min-h-screen bg-gray-50' },
                // Header
                React.createElement('header', { className: 'bg-qld-blue text-white py-6' },
                    React.createElement('div', { className: 'container mx-auto px-4' },
                        React.createElement('h1', { className: 'text-3xl font-bold' }, '🚗 Queensland Fuel Finder'),
                        React.createElement('p', { className: 'text-qld-gold mt-2' }, 'Find the cheapest fuel prices across Queensland'),
                        React.createElement('p', { className: 'text-blue-200 text-sm mt-1' }, '✨ Updated every 30 minutes • 705 suburbs • 2,681+ stations')
                    )
                ),

                // Main Content
                React.createElement('main', { className: 'container mx-auto px-4 py-8' },
                    // Search Form
                    React.createElement('div', { className: 'bg-white rounded-lg shadow-md p-6 mb-8' },
                        React.createElement('h2', { className: 'text-2xl font-semibold mb-4' }, '🔍 Search for Fuel Prices'),
                        React.createElement('div', { className: 'grid md:grid-cols-3 gap-4' },
                            React.createElement('div', null,
                                React.createElement('label', { className: 'block text-sm font-medium text-gray-700 mb-2' }, 'Queensland Suburb'),
                                React.createElement(SuburbAutocomplete, {
                                    value: suburb,
                                    onChange: setSuburb,
                                    onSelect: (selected) => {
                                        setSuburb(selected);
                                        setSelectedSuburb(selected);
                                    }
                                })
                            ),
                            React.createElement('div', null,
                                React.createElement('label', { className: 'block text-sm font-medium text-gray-700 mb-2' }, 'Fuel Type'),
                                React.createElement('select', {
                                    value: fuelType,
                                    onChange: (e) => setFuelType(e.target.value),
                                    className: 'w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-qld-blue focus:border-transparent'
                                },
                                    FUEL_TYPES.map((type) =>
                                        React.createElement('option', {
                                            key: type.code || type.id,
                                            value: type.code || type.name
                                        }, type.name)
                                    )
                                )
                            ),
                            React.createElement('div', { className: 'flex items-end' },
                                React.createElement('button', {
                                    onClick: handleSearch,
                                    disabled: loading,
                                    className: 'w-full bg-qld-blue text-white px-6 py-2 rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors'
                                }, loading ? '🔄 Searching...' : '🚀 Find Cheapest Fuel')
                            )
                        ),
                        error && React.createElement('div', { className: 'mt-4 p-3 bg-red-100 text-red-700 rounded-lg' }, '⚠️ ' + error)
                    ),

                    // Results
                    stations.length > 0 && React.createElement('div', { className: 'space-y-6' },
                        // Summary
                        React.createElement('div', { className: 'bg-white rounded-lg shadow-md p-6' },
                            React.createElement('div', { className: 'flex justify-between items-center mb-4' },
                                React.createElement('h3', { className: 'text-xl font-semibold' }, `📍 Fuel Prices in ${selectedSuburb} and nearby areas`),
                                React.createElement('button', {
                                    onClick: exportToCSV,
                                    className: 'bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-colors'
                                }, '📥 Export CSV')
                            ),
                            React.createElement('div', { className: 'grid grid-cols-2 md:grid-cols-4 gap-4' },
                                React.createElement('div', { className: 'text-center' },
                                    React.createElement('div', { className: 'text-2xl font-bold text-green-600' }, '$' + convertPrice(minPrice)),
                                    React.createElement('div', { className: 'text-sm text-gray-600' }, '💚 Cheapest Price')
                                ),
                                React.createElement('div', { className: 'text-center' },
                                    React.createElement('div', { className: 'text-2xl font-bold text-red-600' }, '$' + convertPrice(maxPrice)),
                                    React.createElement('div', { className: 'text-sm text-gray-600' }, '🔴 Most Expensive')
                                ),
                                React.createElement('div', { className: 'text-center' },
                                    React.createElement('div', { className: 'text-2xl font-bold text-blue-600' }, '$' + convertPrice(maxPrice - minPrice)),
                                    React.createElement('div', { className: 'text-sm text-gray-600' }, '📊 Price Range')
                                ),
                                React.createElement('div', { className: 'text-center' },
                                    React.createElement('div', { className: 'text-2xl font-bold text-purple-600' }, stations.length),
                                    React.createElement('div', { className: 'text-sm text-gray-600' }, '⛽ Stations Found')
                                )
                            ),
                            React.createElement('div', { className: 'mt-4 p-3 bg-blue-50 rounded-lg' },
                                React.createElement('p', { className: 'text-blue-800 text-sm' }, 
                                    `💡 Potential Savings: You could save $${convertPrice(maxPrice - minPrice)} per liter by choosing the cheapest option!`
                                )
                            )
                        ),

                        // Map View
                        React.createElement('div', { className: 'bg-white rounded-lg shadow-md p-6' },
                            React.createElement('h3', { className: 'text-xl font-semibold mb-4' }, '🗺️ Station Locations'),
                            React.createElement('div', { className: 'mb-4' },
                                React.createElement('div', { className: 'flex items-center space-x-4 text-sm' },
                                    React.createElement('div', { className: 'flex items-center' },
                                        React.createElement('div', { 
                                            className: 'w-6 h-4 rounded mr-2',
                                            style: { 
                                                background: 'linear-gradient(45deg, #228B22, #32CD32)',
                                                border: '2px solid #FFD700'
                                            }
                                        }),
                                        React.createElement('span', null, '🏆 Absolute Cheapest')
                                    ),
                                    React.createElement('div', { className: 'flex items-center' },
                                        React.createElement('div', { 
                                            className: 'w-4 h-4 rounded-full mr-2',
                                            style: { backgroundColor: '#228B22' }
                                        }),
                                        React.createElement('span', null, 'Cheapest')
                                    ),
                                    React.createElement('div', { className: 'flex items-center' },
                                        React.createElement('div', { 
                                            className: 'w-4 h-4 rounded-full mr-2',
                                            style: { backgroundColor: '#FFD700' }
                                        }),
                                        React.createElement('span', null, 'Moderate')
                                    ),
                                    React.createElement('div', { className: 'flex items-center' },
                                        React.createElement('div', { 
                                            className: 'w-4 h-4 rounded-full mr-2',
                                            style: { backgroundColor: '#FF8C00' }
                                        }),
                                        React.createElement('span', null, 'Expensive')
                                    ),
                                    React.createElement('div', { className: 'flex items-center' },
                                        React.createElement('div', { 
                                            className: 'w-4 h-4 rounded-full mr-2',
                                            style: { backgroundColor: '#DC143C' }
                                        }),
                                        React.createElement('span', null, 'Most Expensive')
                                    )
                                )
                            ),
                            React.createElement(FuelStationMap, {
                                stations: stations,
                                fuelType: fuelType,
                                selectedSuburb: selectedSuburb
                            }),
                            React.createElement('p', { className: 'text-sm text-gray-600 mt-4' },
                                '💡 Click markers for station details. Map shows exact locations so you can plan your route!'
                            )
                        ),

                        // Cheapest Stations
                        React.createElement('div', null,
                            React.createElement('h3', { className: 'text-xl font-semibold mb-4 text-green-700' }, '🏆 15 Cheapest Fuel Stations'),
                            React.createElement('div', { className: 'grid md:grid-cols-2 lg:grid-cols-3 gap-4' },
                                cheapestStations.map((station) =>
                                    React.createElement(StationCard, {
                                        key: station.siteId,
                                        station: station,
                                        fuelType: fuelType,
                                        onShowChart: () => alert(`Showing price trend for ${station.name}`)
                                    })
                                )
                            )
                        ),

                        // Most Expensive Station
                        mostExpensiveStation.length > 0 && React.createElement('div', null,
                            React.createElement('h3', { className: 'text-xl font-semibold mb-4 text-red-700' }, '📍 Most Expensive (Reference)'),
                            React.createElement('div', { className: 'grid md:grid-cols-2 lg:grid-cols-3 gap-4' },
                                mostExpensiveStation.map((station) =>
                                    React.createElement(StationCard, {
                                        key: station.siteId,
                                        station: station,
                                        fuelType: fuelType,
                                        onShowChart: () => alert(`Showing price trend for ${station.name}`),
                                        isExpensive: true
                                    })
                                )
                            )
                        ),

                        // Tips
                        React.createElement('div', { className: 'bg-blue-50 rounded-lg p-4' },
                            React.createElement('h4', { className: 'font-semibold text-blue-800 mb-2' }, '💡 Tips for Saving on Fuel'),
                            React.createElement('ul', { className: 'text-blue-700 text-sm space-y-1' },
                                React.createElement('li', null, '• Prices are updated every 30 minutes during business hours'),
                                React.createElement('li', null, '• Consider travelling to nearby suburbs for significant savings'),
                                React.createElement('li', null, '• Check price trends before filling up - prices may drop soon'),
                                React.createElement('li', null, '• Some stations offer loyalty programs for additional discounts'),
                                React.createElement('li', null, '• Fill up early in the week when prices are often lower')
                            )
                        )
                    ),

                    // Getting Started Guide
                    !loading && stations.length === 0 && !selectedSuburb && React.createElement('div', { className: 'bg-white rounded-lg shadow-md p-8' },
                        React.createElement('h3', { className: 'text-2xl font-semibold text-center mb-6' }, '🚀 How to Use Queensland Fuel Finder'),
                        React.createElement('div', { className: 'grid md:grid-cols-3 gap-6' },
                            React.createElement('div', { className: 'text-center' },
                                React.createElement('div', { className: 'text-4xl mb-3' }, '🏙️'),
                                React.createElement('h4', { className: 'font-semibold mb-2' }, '1. Choose Your Suburb'),
                                React.createElement('p', { className: 'text-gray-600 text-sm' }, 'Select from 705 Queensland suburbs. Start typing and we\'ll suggest matches.')
                            ),
                            React.createElement('div', { className: 'text-center' },
                                React.createElement('div', { className: 'text-4xl mb-3' }, '⛽'),
                                React.createElement('h4', { className: 'font-semibold mb-2' }, '2. Select Fuel Type'),
                                React.createElement('p', { className: 'text-gray-600 text-sm' }, 'Choose from Unleaded, Diesel, Premium, or other fuel types available.')
                            ),
                            React.createElement('div', { className: 'text-center' },
                                React.createElement('div', { className: 'text-4xl mb-3' }, '💰'),
                                React.createElement('h4', { className: 'font-semibold mb-2' }, '3. Find Savings'),
                                React.createElement('p', { className: 'text-gray-600 text-sm' }, 'Compare prices, view trends, and save money on every fill-up!')
                            )
                        )
                    )
                ),

                // Footer
                React.createElement('footer', { className: 'bg-gray-800 text-white py-8 mt-12' },
                    React.createElement('div', { className: 'container mx-auto px-4 text-center' },
                        React.createElement('p', null, 'Queensland Fuel Finder - Built with Queensland Government Fuel Price Data'),
                        React.createElement('p', { className: 'text-gray-400 text-sm mt-2' }, 'Data updated every 30 minutes • Prices in Australian Dollars')
                    )
                )
            );
        };

        // Render the app
        ReactDOM.render(React.createElement(App), document.getElementById('root'));
    </script>
</body>
</html>